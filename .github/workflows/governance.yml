name: Governance CI

on:
  pull_request:
    branches: [ "main" ]
  push:
    branches: [ "main" ]

jobs:
  quality:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Python 3.5.10
        uses: actions/setup-python@v5
        with:
          python-version: "3.5.10"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade "pip<21" "setuptools<45" "wheel<0.35"
          pip install -r requirements.txt
          pip install -r requirements-dev.txt

      - name: Run tests with coverage
        run: |
          pytest --maxfail=1 --disable-warnings --cov=conduit --cov-report=xml --cov-report=term || true

      - name: Cyclomatic complexity (radon)
        run: |
          radon cc -s -a conduit/apps | tee radon-report.txt
          radon mi -s conduit/apps | tee -a radon-report.txt

      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: governance-reports
          path: |
            coverage.xml
            radon-report.txt


